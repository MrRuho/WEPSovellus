<!DOCTYPE html>
<html>
    <head>    
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    </head>

    <body>
        <div class="navbar">
            <div style="text-align: right;">
              <p>Olet kirjautunut nimellä {{ session.username }}</p>
            </div>
            <div class="navbar-links">
              <a href="/topics">Aiheet</a>
              <a href="/profile">Oma profiili</a>
              {% if admin %}<a href="/admin">Admin työkalut</a>{% endif %}
              <a href="/logout">Kirjaudu ulos</a>
            </div>
            <div style="text-align: center;">
                <h1>FORUM</h1>
                <p>Puhe on vapaa</p>
            </div>
            <div class="back-link">
            <a href="/topics">Palaa</a>
            </div>
        </div>
        <div class="topic_container">
            <div class="topic-header">
                <h1>{{ topic.header }}</h1>
            </div>
            <div class="topic-content">
                <p1>{{ topic.content }}</p1>
                <p>{{ topic.sender }}</p>
            </div>
        </div>
        {% if topic.sender == session.username or admin %}
            <form id="delete-form" action="/hide_topic/{{ topic.id }}" method="POST" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                <input type="submit" value="Poista" class="custom-button" onclick="return confirm('Haluatko varmasti poistaa viestin?');">
            </form>
        {% endif %}
        {% if topic.sender == session.username %}
            <form id="edit-form" action="/edit_topic/{{ topic.id }}" method="POST" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                <input type="submit" value="Muokkaa" class="custom-button">
            </form>
        {% endif %}
        <hr>

        <h4>Kommentit</h4>
        {% for comment in comments %}
            {% if comment.visible %}
                <div class="comment-container">
                    <div class="comment-bubble">
                        <p class="comment-sender">{{ comment.sender }}:</p>
                        <p>{{ comment.content }}</p>
                        {% if comment.sender == session.username or admin %}
                            <form id="delete-form" action="/delete_comment/{{ comment.id }}" method="POST" style="display: inline;">
                                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                                <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                <input type="submit" value="Poista" class="custom-button" onclick="return confirm('Haluatko varmasti poistaa viestin?');">
                            </form>
                        {% endif %}
                        {% if comment.sender == session.username%}
                            <form id="edit-form" action="/edit_comment/{{ comment.id }}" method="POST" style="display: inline;">
                                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                                <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                <input type="submit" value="Muokkaa" class="custom-button"> 
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

        <div class="comment-box">
            {% if blocked_user %}
                <p>
                Et voi kommentoida! Käyttöoikeuksiasi on rajattu vielä {{ penalty_time }}. Odotellessa voit kertailla talon sääntöjä. 1. Don't be an a**hole! 2. Obey state laws!
                </p>
                <br>
                <div class="back-link">
                    <a href="/topics">Palaa</a>
                </div>
            {% else %}
            <form action="/comment" method="POST">
                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                <input type="hidden" name="topic_id" value="{{ topic.id }}">                
                Kommentoi: <br>
                <textarea name="comment" rows="3" cols="40"></textarea>
                <br>
                <input type="submit" value="Lähetä">     
            </form>
            <br>
            <div class="back-link">
                <a href="/topics">Palaa</a>
            </div>
            {% endif %} 
        </div>
            
    </body>
</html>